import{jsx as e}from"react/jsx-runtime";import{useLayoutEffect as t,useEffect as r,useRef as n,memo as o,useMemo as i,forwardRef as l,Children as s,useState as c,useImperativeHandle as u}from"react";import{useSyncExternalStore as a}from"use-sync-external-store/shim/index.js";const d=Math.min,_=Math.max,h=Date.now,f=e=>null!=e,g=(e,t)=>Array.from({length:e},((e,r)=>t(r))),m=e=>{let t,r;return(...n)=>(t||(t=!0,r=e(...n)),r)},w=(e,t)=>{const r=e.t[t];return-1===r?e.o:r},S=(e,t,r)=>{if(!e.i)return 0;if(e.l>=t)return r?e.u[t]+w(e,t):e.u[t];let n=e.l,o=e.u[n];for(;n<=t&&(e.u[n]=o,n!==t||r);)o+=w(e,n),n++;return e.l=t,o},v=(e,t)=>S(e,t),p=(e,t,r)=>{let n=0;if(r>=0)for(;t<e.i-1;){const o=w(e,t++);if((n+=o)>=r){n-o/2>=r&&t--;break}}else for(;t>0;){const o=w(e,--t);if((n-=o)<=r){n+o/2<r&&t++;break}}return d(_(t,0),e.i-1)},z=(e,t,r,n)=>p(e,r,t-n),I=p,b=(e,t,r)=>({o:t,i:e,l:r?d(r.l,e-1):0,t:g(e,(e=>{const t=r&&r.t[e];return f(t)?t:-1})),u:g(e,(e=>{if(0===e)return 0;const t=r&&r.u[e];return f(t)?t:-1}))}),x=(e,t,r,n,o=0,i,l)=>{let s,c=t*_(o-1,0),u=0,a=[],h=b(e,t),f=0,g=[0,o];const m=new Set;return{_(){const[e,t]=g,r=v(h,e),n=z(h,u,e,r),o=I(h,n,c);return e===n&&t===o?g:g=[n,o]},h:e=>-1===h.t[e],g:e=>((e,t,r)=>{for(let n=t;n<=r;n++)if(-1===e.t[n])return!0;return!1})(h,e,I(h,e,c)),m:e=>v(h,e),S:e=>w(h,e),v:()=>u,p:()=>c,I:()=>(e=>S(e,e.i-1,!0))(h),R:()=>a,T:()=>r,M:()=>n,C:e=>z(h,e,0,0),O:()=>(s&&s[1](),new Promise(((e,t)=>{s=[()=>{Promise.resolve().then((()=>{e(),s=void 0}))},t]}))),W:e=>(m.add(e),()=>{m.delete(e)}),H(e,t){const r=(()=>{switch(e){case 1:{const e=t.filter((([e,t])=>h.t[e]!==t));if(!e.length)return!1;const r=[];return e.forEach((([e,t])=>{r.push([t-w(h,e),e]),((e,t,r)=>{e.t[t]=r,e.l=d(t,e.l)})(h,e,t)})),a=r,!0}case 2:return c!==t&&(c=t,!0);case 3:case 4:{const e=u;return(u=t)!==e}}})();r&&(m.forEach((e=>{e()})),3===e?l(u):s&&1===e&&s[0]())},k:()=>f,D(e){const t=f;f=e,0===f?i(!1):0!==t||1!==f&&2!==f||i(!0)},J(e){h.i!==e&&(h=b(e,t,h))}}},y="undefined"!=typeof window?t:r,R=(e,t)=>a(e,t,t),T=m((e=>{const t="scrollLeft",r=e[t];e[t]=1;const n=e[t]<1;return e[t]=r,n})),M=(e,t)=>{let r;const n=e.T(),o=e.M(),i=n?"scrollLeft":"scrollTop",l=()=>r?n?r.scrollWidth:r.scrollHeight:0,s=(t,n)=>T(r)||n?-t:e.I()-e.p()-t,c=(t,l)=>{r&&(n&&o&&(t=s(t,l)),l?r[i]+=t:(r[i]=t,e.D(3)))},u=async(t,r)=>{const n=()=>{let t=r();const n=l(),o=e.p();return n-(t+o)<=0&&(t=n-o),t};if(e.g(t)){do{e.H(4,n());try{await e.O()}catch(e){return}}while(e.g(t));c(n())}else{const t=n();c(t),e.H(4,t)}},a=e=>e.reduce(((e,[t])=>e+t),0);return{$(l){r=l;const c=()=>{let r=l[i];n&&o&&(r=s(r));const c=e.v();if(c===r)return;const u=e.k(),a=t();0!==u&&a||3===u||e.D(c>r?2:1),e.H(3,r)},u=(()=>{let t;const r=()=>{f(t)&&clearTimeout(t)},n=()=>{r(),t=setTimeout((()=>{t=null,c(),e.D(0)}),150)};return n.L=r,n})(),a=()=>{c(),u()},d=(()=>{let t=h()-50;return(...r)=>{const o=h();t+50<o&&(t=o,(t=>{if(0!==e.k()&&!t.ctrlKey&&(n?t.deltaX:t.deltaY)){const t=e.v();t>0&&t<e.I()-e.p()&&u()}})(...r))}})();return l.addEventListener("scroll",a),l.addEventListener("wheel",d,{passive:!0}),()=>{l.removeEventListener("scroll",a),l.removeEventListener("wheel",d),u.L()}},j:l,A(t){t=_(t,0),u(e.C(t),(()=>t))},F(t,r){t=_(d(t,r-1),0),u(t,(()=>e.m(t)))},P:(t,r)=>{const n=e.k();if(2===n){const e=a(t);e&&c(e,!0)}else if(3===n){const n=e.v();if(0===n);else{const o=a(t);if(e.I()-(n+e.p()+o)<=0)o&&c(n+o);else{const e=t.reduce(((e,[t,n])=>(n<r&&(e+=t),e)),0);e&&c(e,!0)}}}}}},C="current",O=e=>{const t=n();return t[C]||(t[C]=e())},W=e=>{const t=n(e);return y((()=>{t[C]=e}),[e]),t},E=/*#__PURE__*/o((({U:t,B:r,V:o,q:l,G:s})=>{const c=n(null),u=R(o.W,(()=>o.m(l))),a=R(o.W,(()=>o.h(l)));return y((()=>r.K(c[C],l)),[l]),e(s,{ref:c,style:i((()=>{const e=o.T(),t=o.M()?"right":"left",r={margin:0,padding:0,position:"absolute",[e?"height":"width"]:"100%",[e?"top":t]:0,[e?t:"top"]:u,visibility:a?"hidden":"visible"};return e&&(r.display="flex"),r}),[u,a]),children:t})})),H=/*#__PURE__*/l((({children:t,scrollSize:r,scrolling:n,horizontal:o,attrs:l},s)=>e("div",{ref:s,...l,children:e("div",{style:i((()=>({position:"relative",visibility:"hidden",width:o?r:"100%",height:o?"100%":r,pointerEvents:n?"none":"auto"})),[r,n]),children:t})}))),k=({U:t,N:r,V:n,G:o,X:l,Y:s})=>{const c=R(n.W,n.I),u=n.T();return e(o,{ref:r,scrollSize:c,scrolling:l,horizontal:u,attrs:i((()=>({...s,style:{overflow:u?"auto hidden":"hidden auto",contain:"strict",width:"100%",height:"100%",padding:0,margin:0,...s.style}})),[s]),children:t})},D=/*#__PURE__*/l((({children:t,itemSize:o=40,overscan:l=4,initialItemCount:a,horizontal:h,rtl:g,element:w=H,itemElement:S="div",onScroll:v,onScrollStop:p,onRangeChange:z,...I},b)=>{const T=i((()=>{const e=[];return s.forEach(t,(t=>{(e=>!f(e)||"boolean"==typeof e)(t)||e.push(t)})),e}),[t]),D=T.length,J=W(v),$=W(p),[L,j]=c(new Set),[A,F]=c(!1),[P,U,B]=O((()=>{const e=x(D,o,!!h,!!g,a,(e=>{F(e),e||(j(new Set),$[C]&&$[C]())}),(e=>{J[C]&&J[C](e)})),t=(e=>{let t,r=!1;const n=e.T()?"width":"height",o=new WeakMap,i=m((()=>new ResizeObserver((i=>{const l=[];for(const{target:r,contentRect:s}of i)if(r===t)e.H(2,s[n]);else{const e=o.get(r);f(e)&&l.push([e,s[n]])}l.length&&(e.H(1,l),r=!0)}))));return{Z(e){t=e;const r=i();return r.observe(e),()=>{r.disconnect()}},K(e,t){const r=i();return o.set(e,t),r.observe(e),()=>{o.delete(e),r.unobserve(e)}},ee(){const e=r;return r=!1,e}}})(e);return[e,t,M(e,t.ee)]}));P.J(D);const[V,q]=R(P.W,P._),G=R(P.W,P.R),K=n(null);y((()=>{const e=K[C],t=U.Z(e),r=B.$(e);return()=>{t(),r()}}),[]),y((()=>{G.length&&B.P(G,V)}),[G]),r((()=>{z&&z({start:V,end:q,count:D})}),[V,q]),u(b,(()=>({get scrollOffset(){return P.v()},get scrollSize(){return B.j()},get viewportSize(){return P.p()},scrollToIndex(e){B.F(e,D)},scrollTo:B.A,scrollBy(e){B.A(P.v()+e)}})),[D]);const N=_(V-l,0),Q=d(q+l,D-1),X=i((()=>{const t=[];for(let e=N;e<=Q;e++)L.add(e);return L.forEach((r=>{const n=T[r];f(n)&&t.push(e(E,{B:U,V:P,q:r,G:S,U:n},(null==n?void 0:n.key)||r))})),t}),[T,L,N,Q]);return e(k,{N:K,V:P,G:w,X:A,U:X,Y:I})})),J=(e,t)=>`${e}-${t}`,$=/*#__PURE__*/o((({U:t,B:r,te:o,re:l,ne:s,oe:c,G:u})=>{const a=n(null),d=R(o.W,(()=>o.m(s))),_=R(l.W,(()=>l.m(c))),h=R(o.W,(()=>o.h(s))),f=R(l.W,(()=>l.h(c))),g=R(o.W,(()=>o.S(s))),m=R(l.W,(()=>l.S(c)));return y((()=>r.K(a[C],s,c)),[c,s]),e(u,{ref:a,style:i((()=>({display:"grid",margin:0,padding:0,position:"absolute",top:d,[o.M()?"right":"left"]:_,visibility:h||f?"hidden":"visible",minHeight:g,minWidth:m})),[d,_,m,g,h,f]),children:t})})),L=/*#__PURE__*/l((({children:t,scrollWidth:r,scrollHeight:n,scrolling:o,attrs:l},s)=>e("div",{ref:s,...l,children:e("div",{style:i((()=>({position:"relative",visibility:"hidden",width:r,height:n,pointerEvents:o?"none":"auto"})),[r,n,o]),children:t})}))),j=({U:t,N:r,ie:n,le:o,G:l,X:s,Y:c})=>{const u=R(n.W,n.I),a=R(o.W,o.I);return e(l,{ref:r,scrollWidth:a,scrollHeight:u,scrolling:s,attrs:i((()=>({...c,style:{overflow:"auto",contain:"strict",width:"100%",height:"100%",padding:0,margin:0,...c.style}})),[c]),children:t})},A=/*#__PURE__*/l((({children:t,row:r,col:o,cellHeight:l=40,cellWidth:s=100,overscan:u=2,initialRowCount:a,initialColCount:h,rtl:f,element:g=L,cellElement:w="div",...S})=>{const[v,p]=c(!1),[z,I]=c(!1),[b,T,W,E,H]=O((()=>{const e=()=>{},t=x(r,l,!1,!!f,a,p,e),n=x(o,s,!0,!!f,h,I,e),i=((e,t)=>{let r,n=!1,o=!1;const i="height",l="width",s=new WeakMap,c=new Set,u=new Set,a=new Map,d=(e,t)=>`${e}-${t}`,h=m((()=>new ResizeObserver((h=>{const f=new Set,g=new Set;for(const{target:n,contentRect:o}of h)if(n===r)e.H(2,o[i]),t.H(2,o[l]);else{const e=s.get(n);if(e){const[t,r]=e,n=d(t,r),s=a.get(n),c=[o[i],o[l]];let u,_;s?(s[0]!==c[0]&&(u=!0),s[1]!==c[1]&&(_=!0)):u=_=!0,u&&f.add(t),_&&g.add(r),(u||_)&&a.set(n,c)}}if(f.size){const t=[];f.forEach((e=>{let r=0;u.forEach((t=>{const n=a.get(d(e,t));n&&(r=_(r,n[0]))})),r&&t.push([e,r])})),e.H(1,t),n=!0}if(g.size){const e=[];g.forEach((t=>{let r=0;c.forEach((e=>{const n=a.get(d(e,t));n&&(r=_(r,n[1]))})),r&&e.push([t,r])})),t.H(1,e),o=!0}}))));return{Z(e){r=e;const t=h();return t.observe(e),()=>{t.disconnect()}},K(e,t,r){const n=h();return s.set(e,[t,r]),c.add(t),u.add(r),n.observe(e),()=>{s.delete(e),n.unobserve(e)}},ee(e){const t=e?o:n;return e?o=!1:n=!1,t}}})(t,n);return[t,n,i,M(t,(()=>i.ee())),M(n,(()=>i.ee(!0)))]}));b.J(r),T.J(o);const[k,D]=R(b.W,b._),[A,F]=R(T.W,T._),P=R(b.W,b.R),U=R(T.W,T.R),B=n(null);y((()=>{const e=B[C],t=W.Z(e),r=E.$(e),n=H.$(e);return()=>{t(),r(),n()}}),[]),y((()=>{P.length&&E.P(P,k)}),[P]),y((()=>{U.length&&H.P(U,A)}),[U]);const V=i((()=>{const e=new Map;return(r,n)=>{let o=e.get(J(r,n));return o||e.set(J(r,n),o=t({rowIndex:r,colIndex:n})),o}}),[t]),q=_(k-u,0),G=d(D+u,r-1),K=_(A-u,0),N=d(F+u,o-1),Q=i((()=>{const t=[];for(let r=q;r<=G;r++)for(let n=K;n<=N;n++)t.push(e($,{B:W,te:b,re:T,ne:r,oe:n,G:w,U:V(r,n)},J(r,n)));return t}),[V,q,G,K,N]);return e(j,{N:B,ie:b,le:T,G:g,X:v||z,U:Q,Y:S})}));export{A as VGrid,D as VList};
//# sourceMappingURL=index.mjs.map
